<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smooth Scroll Video</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      font-family: Roboto, -apple-system, sans-serif;
      background: #000;
      color: #fff;
    }

    html.lenis, html.lenis body {
      height: auto;
    }

    .lenis.lenis-smooth {
      scroll-behavior: auto !important;
    }

    .loader {
      position: fixed;
      inset: 0;
      --blur-amount: 50px;
      backdrop-filter: blur(var(--blur-amount));
      z-index: 1000;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .loader-inner {
      height: 100svh;
      display: flex;
      flex-direction: column;
      align-items: start;
      justify-content: end;
    }

    .loader.hidden {
      opacity: 0;
      visibility: hidden;
      --blur-amount: 0px;
    }

    .loader-text {
      font-size: clamp(4rem, (5vw + 2rem), 10rem);
      font-weight: bold;
      padding-left: 0.2em;
    }

    .loader-bar {
      width: 100%;
      height: 1rem;
      background: rgba(255,255,255,0.2);
      overflow: hidden;
    }

    .loader-fill {
      height: 100%;
      background: linear-gradient(90deg, white);
      width: 0%;
      transition: width 0.1s ease;
    }

    .scene-1-section {
      position: relative;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      cursor: pointer;
    }

    .scene-1-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .tap-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: opacity 0.4s ease, visibility 0.4s ease;
    }

    .tap-overlay.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    .play-button {
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      transition: transform 0.3s ease, background 0.3s ease;
    }

    .play-button img, .play-button svg {
      display: block;
      width: 2.5rem;
      height: 2.5rem;
      object-fit: contain;
    }

    .play-button:hover {
      transform: scale(1.1);
      background: rgba(255, 255, 255, 0.1);
    }

    .tap-text {
      font-size: 12px;
      text-transform: uppercase;
      font-weight: bold;
      text-shadow: 2px 2px #000;
      letter-spacing: 1px;
    }

    .canvas-1-section,
    .canvas-2-section,
    .canvas-3-section,
    .canvas-4-section,
    .canvas-5-section,
    .canvas-6-section {
      position: relative;
      height: 130vh;
    }

    .canvas-1-section {
      height: 110vh;
    }

    .canvas-2-section {
      height: 150vh;
    }

    .canvas-3-section {
      height: 140vh;
    }

    .canvas-container {
      position: sticky;
      top: 0;
      height: 100vh;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    #frame-canvas,
    #frame-canvas-2,
    #frame-canvas-3,
    #frame-canvas-4,
    #frame-canvas-5,
    #frame-canvas-6 {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .scroll-hint {
      position: absolute;
      inset: 0;
    }

    .scroll-hint .inner {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      height: 100svh;
      justify-content: end;
      align-items: center;
      padding-bottom: 2rem;
    }

    .scroll-hint .inner img,
    .scroll-hint .inner svg {
      display: block;
      width: 2.5rem;
      height: 2.5rem;
      object-fit: contain;
      animation: scroll-hint-animation 1s ease-in-out infinite alternate;
    }

    .scroll-hint .inner .text {
      font-size: 12px;
      text-transform: uppercase;
      font-weight: bold;
      text-shadow: 2px 2px #000;
      letter-spacing: 1px;
    }

    .scene-2-section,
    .scene-3-section,
    .scene-4-section,
    .scene-5-section,
    .scene-6-section,
    .scene-7-section {
      position: relative;
      height: 100vh;
      display: none;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .scene-2-video,
    .scene-3-video,
    .scene-4-video,
    .scene-5-video,
    .scene-6-video,
    .scene-7-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .scene-1-video:focus,
    .scene-2-video:focus,
    .scene-3-video:focus,
    .scene-4-video:focus,
    .scene-5-video:focus,
    .scene-6-video:focus,
    .scene-7-video:focus {
      outline: none;
    }

    .scene-1-video:active,
    .scene-2-video:active,
    .scene-3-video:active,
    .scene-4-video:active,
    .scene-5-video:active,
    .scene-6-video:active,
    .scene-7-video:active {
      outline: none;
    }

    body.no-scroll {
      overflow: hidden;
    }

    .pause-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      transition: opacity 0.3s ease;
      pointer-events: none;
      opacity: 0;
    }

    .pause-button {
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .pause-button img,
    .pause-button svg {
      display: block;
      width: 2.5rem;
      height: 2.5rem;
      object-fit: contain;
    }

    .scene-1-section.paused .pause-overlay,
    .scene-2-section.paused .pause-overlay,
    .scene-3-section.paused .pause-overlay,
    .scene-4-section.paused .pause-overlay,
    .scene-5-section.paused .pause-overlay,
    .scene-6-section.paused .pause-overlay,
    .scene-7-section.paused .pause-overlay {
      opacity: 1;
    }

    .menu-wrap {
      position: fixed;
      top: 4%;
      right: 6%;
      display: none;
      flex-direction: column;
      align-items: end;
      pointer-events: none;
      z-index: 99;
    }

    .menu-button {
      all: unset;
      pointer-events: auto;
    }

    .menu-button img {
      width: 2.5rem;
      height: 2.5rem;
      object-fit: contain;
      transition: transform 0.3s ease;
    }

    .menu-button:active img {
      transform: scale(0.9);
    }

    .menu-nav {
      background-color: #ffffff80;
      display: flex;
      flex-direction: column;
      justify-content: start;
      clip-path: inset(0% 0% 100% 100%);
      transition: clip-path 0.3s ease;
    }

    .menu-nav button {
      all: unset;
      display: block;
      padding: 8px;
    }

    .menu-nav button img {
      width: 150px;
      object-fit: contain;
    }

    .menu-nav button.active {
      background-color: #fff;
    }

    .menu-wrap.open .menu-nav {
      clip-path: inset(0% 0% 0% 0%);
      pointer-events: auto;
    }

    .rewind-button {
      all: unset;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .rewind-button img {
      width: 2.5rem;
      height: 2.5rem;
    }

    .home-link {
      all: unset;
      position: absolute;
      bottom: 26%;
      right: 18%;
    }

    .home-link img {
      height: 2rem;
      width: auto;
    }

    .progress-circle {
      position: absolute;
      bottom: 2rem;
      right: 6%;
      width: 2.5rem;
      height: 2.5rem;
      z-index: 10;
      pointer-events: none;
    }

    .progress-circle svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .progress-circle .progress-ring {
      fill: none;
      stroke: rgba(255, 255, 255, 0.3);
      stroke-width: 2;
    }

    .progress-circle .progress-fill {
      fill: none;
      stroke: rgba(255, 255, 255, 0.9);
      stroke-width: 2;
      stroke-dasharray: 100.53;
      stroke-dashoffset: 100.53;
      transition: stroke-dashoffset 0.1s ease;
    }

    @keyframes scroll-hint-animation {
      from { transform: translateY(-5px); }
      to { transform: translateY(5px); }
    }
  </style>
</head>
<body class="no-scroll">
  <div class="loader" id="loader">
    <div class="loader-inner">
      <div class="loader-text" id="loader-percentage">0%</div>
      <div class="loader-bar">
        <div class="loader-fill" id="loader-fill"></div>
      </div>
    </div>
  </div>

  <div class="menu-wrap">
    <button class="menu-button">
      <img src="/icons/menu.svg" alt="">
    </button>
    <nav class="menu-nav">
      <button data-scene="1" class="active"><img src="/icons/scene-titles/INTRO-BLUE.webp" alt=""></button>
      <button data-scene="2"><img src="/icons/scene-titles/STUDIO&JAMPSPACE-BLUE.webp" alt=""></button>
      <button data-scene="3"><img src="/icons/scene-titles/ALEA-ARENA-BLUE.webp" alt=""></button>
      <button data-scene="5"><img src="/icons/scene-titles/DOJO-BLUE.webp" alt=""></button>
      <button data-scene="6"><img src="/icons/scene-titles/ATELIER-BLUE.webp" alt=""></button>
      <button data-scene="7"><img src="/icons/scene-titles/PALM-HOUSE-BLUE.webp" alt=""></button>
    </nav>
  </div>

  <section class="scene-1-section" id="scene-1-section">
    <video class="scene-1-video" id="scene-1-video" playsinline preload="auto">
      <source src="scene-1.mp4" type="video/mp4">
    </video>
    <div class="pause-overlay"><div class="pause-button"><img src="/icons/pause.svg" alt=""></div></div>
    <div class="tap-overlay" id="tap-overlay">
      <div class="play-button"><img src="/icons/play.svg" alt=""></div>
      <span class="tap-text">Tap to play</span>
    </div>
  </section>

  <section class="canvas-1-section" id="canvas-1-section">
    <div class="canvas-container">
      <canvas id="frame-canvas"></canvas>
      <div class="scroll-hint"><div class="inner"><img src="/icons/scroll.svg" alt=""><span class="text">Scroll</span></div></div>
      <div class="progress-circle" id="progress-circle-1">
        <svg viewBox="0 0 36 36"><circle class="progress-ring" cx="18" cy="18" r="16"></circle><circle class="progress-fill" cx="18" cy="18" r="16"></circle></svg>
      </div>
    </div>
  </section>

  <section class="scene-2-section" id="scene-2-section">
    <video class="scene-2-video" id="scene-2-video" playsinline preload="auto"><source src="scene-2.mp4" type="video/mp4"></video>
    <div class="pause-overlay"><div class="pause-button"><img src="/icons/pause.svg" alt=""></div></div>
  </section>

  <section class="scene-3-section" id="scene-3-section">
    <video class="scene-3-video" id="scene-3-video" playsinline preload="auto"><source src="scene-3.mp4" type="video/mp4"></video>
    <div class="pause-overlay"><div class="pause-button"><img src="/icons/pause.svg" alt=""></div></div>
  </section>

  <section class="canvas-2-section" id="canvas-2-section">
    <div class="canvas-container">
      <canvas id="frame-canvas-2"></canvas>
      <div class="scroll-hint"><div class="inner"><img src="/icons/scroll.svg" alt=""><span class="text">Scroll</span></div></div>
      <div class="progress-circle" id="progress-circle-2">
        <svg viewBox="0 0 36 36"><circle class="progress-ring" cx="18" cy="18" r="16"></circle><circle class="progress-fill" cx="18" cy="18" r="16"></circle></svg>
      </div>
    </div>
  </section>

  <section class="scene-4-section" id="scene-4-section">
    <video class="scene-4-video" id="scene-4-video" playsinline preload="auto"><source src="scene-4.mp4" type="video/mp4"></video>
    <div class="pause-overlay"><div class="pause-button"><img src="/icons/pause.svg" alt=""></div></div>
  </section>

  <section class="canvas-3-section" id="canvas-3-section">
    <div class="canvas-container">
      <canvas id="frame-canvas-3"></canvas>
      <div class="scroll-hint"><div class="inner"><img src="/icons/scroll.svg" alt=""><span class="text">Scroll</span></div></div>
      <div class="progress-circle" id="progress-circle-3">
        <svg viewBox="0 0 36 36"><circle class="progress-ring" cx="18" cy="18" r="16"></circle><circle class="progress-fill" cx="18" cy="18" r="16"></circle></svg>
      </div>
    </div>
  </section>

  <section class="scene-5-section" id="scene-5-section">
    <video class="scene-5-video" id="scene-5-video" playsinline preload="auto"><source src="scene-5.mp4" type="video/mp4"></video>
    <div class="pause-overlay"><div class="pause-button"><img src="/icons/pause.svg" alt=""></div></div>
  </section>

  <section class="canvas-4-section" id="canvas-4-section">
    <div class="canvas-container">
      <canvas id="frame-canvas-4"></canvas>
      <div class="scroll-hint"><div class="inner"><img src="/icons/scroll.svg" alt=""><span class="text">Scroll</span></div></div>
      <div class="progress-circle" id="progress-circle-4">
        <svg viewBox="0 0 36 36"><circle class="progress-ring" cx="18" cy="18" r="16"></circle><circle class="progress-fill" cx="18" cy="18" r="16"></circle></svg>
      </div>
    </div>
  </section>

  <section class="scene-6-section" id="scene-6-section">
    <video class="scene-6-video" id="scene-6-video" playsinline preload="auto"><source src="scene-6.mp4" type="video/mp4"></video>
    <div class="pause-overlay"><div class="pause-button"><img src="/icons/pause.svg" alt=""></div></div>
  </section>

  <section class="canvas-5-section" id="canvas-5-section">
    <div class="canvas-container">
      <canvas id="frame-canvas-5"></canvas>
      <div class="scroll-hint" id="canvas-5-scroll-hint"><div class="inner"><img src="/icons/scroll.svg" alt=""><span class="text">Scroll</span></div></div>
      <div class="progress-circle" id="progress-circle-5">
        <svg viewBox="0 0 36 36"><circle class="progress-ring" cx="18" cy="18" r="16"></circle><circle class="progress-fill" cx="18" cy="18" r="16"></circle></svg>
      </div>
    </div>
  </section>

  <section class="scene-7-section" id="scene-7-section">
    <video class="scene-7-video" id="scene-7-video" playsinline preload="auto"><source src="scene-7.mp4" type="video/mp4"></video>
    <div class="pause-overlay"><div class="pause-button"><img src="/icons/pause.svg" alt=""></div></div>
  </section>

  <section class="canvas-6-section" id="canvas-6-section">
    <div class="canvas-container">
      <canvas id="frame-canvas-6"></canvas>
      <div class="scroll-hint" id="canvas-6-scroll-hint"><div class="inner"><img src="/icons/scroll.svg" alt=""><span class="text">Scroll</span></div></div>
      <button class="rewind-button" id="rewind-button" style="display: none;"><img src="/icons/rewind.webp" alt=""></button>
      <a href="https://alea.school" class="home-link" id="home-link" style="display: none;"><img src="/icons/home-logo.webp" alt=""></a>
      <div class="progress-circle" id="progress-circle-6">
        <svg viewBox="0 0 36 36"><circle class="progress-ring" cx="18" cy="18" r="16"></circle><circle class="progress-fill" cx="18" cy="18" r="16"></circle></svg>
      </div>
    </div>
  </section>

  <script src="https://unpkg.com/lenis@1.1.13/dist/lenis.min.js"></script>

  <script>
    if ('scrollRestoration' in history) {
      history.scrollRestoration = 'manual';
    }

    const FRAME_COUNT = 27;
    const FRAME_PATH = 'frames/frame_';
    const FRAME_EXT = '.webp';
    
    const FRAME_COUNT_2 = 129;
    const FRAME_PATH_2 = 'frames-2/frame_';
    const FRAME_EXT_2 = '.webp';
    
    const FRAME_COUNT_3 = 164;
    const FRAME_PATH_3 = 'frames-3/frame_';
    const FRAME_EXT_3 = '.webp';
    
    const FRAME_COUNT_4 = 40;
    const FRAME_PATH_4 = 'frames-4/frame_';
    const FRAME_EXT_4 = '.webp';
    
    const FRAME_COUNT_5 = 56;
    const FRAME_PATH_5 = 'frames-5/frame_';
    const FRAME_EXT_5 = '.webp';

    const FRAME_COUNT_6 = 30;
    const FRAME_PATH_6 = 'frames-6/frame_';
    const FRAME_EXT_6 = '.webp';

    const canvas = document.getElementById('frame-canvas');
    const ctx = canvas.getContext('2d');
    const canvas1Section = document.getElementById('canvas-1-section');
    const canvas2 = document.getElementById('frame-canvas-2');
    const ctx2 = canvas2.getContext('2d');
    const canvas2Section = document.getElementById('canvas-2-section');
    const loader = document.getElementById('loader');
    const loaderFill = document.getElementById('loader-fill');
    const loaderPercentage = document.getElementById("loader-percentage");
    const scene1Section = document.getElementById('scene-1-section');
    const scene1Video = document.getElementById('scene-1-video');
    const tapOverlay = document.getElementById('tap-overlay');
    const scene2Section = document.getElementById('scene-2-section');
    const scene2Video = document.getElementById('scene-2-video');
    const scene3Section = document.getElementById('scene-3-section');
    const scene3Video = document.getElementById('scene-3-video');
    const scene4Section = document.getElementById('scene-4-section');
    const scene4Video = document.getElementById('scene-4-video');
    const scene5Section = document.getElementById('scene-5-section');
    const scene5Video = document.getElementById('scene-5-video');
    const scene6Section = document.getElementById('scene-6-section');
    const scene6Video = document.getElementById('scene-6-video');
    const scene7Section = document.getElementById('scene-7-section');
    const scene7Video = document.getElementById('scene-7-video');
    const canvas3 = document.getElementById('frame-canvas-3');
    const ctx3 = canvas3.getContext('2d');
    const canvas3Section = document.getElementById('canvas-3-section');
    const canvas4 = document.getElementById('frame-canvas-4');
    const ctx4 = canvas4.getContext('2d');
    const canvas4Section = document.getElementById('canvas-4-section');
    const canvas5 = document.getElementById('frame-canvas-5');
    const ctx5 = canvas5.getContext('2d');
    const canvas5Section = document.getElementById('canvas-5-section');
    const canvas5ScrollHint = document.getElementById('canvas-5-scroll-hint');
    const canvas6 = document.getElementById('frame-canvas-6');
    const ctx6 = canvas6.getContext('2d');
    const canvas6Section = document.getElementById('canvas-6-section');
    const canvas6ScrollHint = document.getElementById('canvas-6-scroll-hint');
    const rewindButton = document.getElementById('rewind-button');
    const homeLink = document.getElementById('home-link');
    const progressCircle1 = document.getElementById('progress-circle-1');
    const progressCircle2 = document.getElementById('progress-circle-2');
    const progressCircle3 = document.getElementById('progress-circle-3');
    const progressCircle4 = document.getElementById('progress-circle-4');
    const progressCircle5 = document.getElementById('progress-circle-5');
    const progressCircle6 = document.getElementById('progress-circle-6');

    const frames = [];
    let currentFrame = 0;
    let targetFrame = 0;
    let imagesLoaded = 0;
    
    const frames2 = [];
    let currentFrame2 = 0;
    let targetFrame2 = 0;
    let imagesLoaded2 = 0;
    
    const frames3 = [];
    let currentFrame3 = 0;
    let targetFrame3 = 0;
    let imagesLoaded3 = 0;
    
    const frames4 = [];
    let currentFrame4 = 0;
    let targetFrame4 = 0;
    let imagesLoaded4 = 0;
    
    const frames5 = [];
    let currentFrame5 = 0;
    let targetFrame5 = 0;
    let imagesLoaded5 = 0;
    
    const frames6 = [];
    let currentFrame6 = 0;
    let targetFrame6 = 0;
    let imagesLoaded6 = 0;
    
    let lenis = null;
    let scene1Played = false;
    let scene2Played = false;
    let scene4Played = false;
    let scene5Played = false;
    let scene6Played = false;
    let scene7Played = false;
    let lastScrollPosition = 0;
    let maxScrollReached = 0;
    let isCorrectingScroll = false;
    
    let warmingUpVideos = new Set();
    let isAutoAnimating = false;
    
    // Only first and last canvas get auto-complete
    let canvas1FirstScrollTriggered = false;
    let canvas6FirstScrollTriggered = false;

    let lastBlurProgress = -1;
    let initialLoadingComplete = false;

    // Audio elements for frame sounds
    const frameSoundWhoose = new Audio('sfx/whoose.mp3');
    const frameSoundSunTransition = new Audio('sfx/basket-ball-to-arieal.mp3');
    const frameSoundBreath = new Audio('sfx/breath.mp3');
    const frameSoundGrass = new Audio('sfx/grass.mp3');
    const frameSoundOutro = new Audio('sfx/outro.mp3');

    // Frame thresholds for playing sounds
    const SOUND_FRAME_THRESHOLD_WHOOSE = 1;
    const SOUND_FRAME_THRESHOLD_SUN_TRANSITION = 1;
    const SOUND_FRAME_THRESHOLD_BREATH = 20;
    const SOUND_FRAME_THRESHOLD_GRASS = 5;
    const SOUND_FRAME_THRESHOLD_OUTRO = 3;

    // Track if sound has been played for each animation
    let soundPlayedAtWhoose = false;
    let soundPlayedAtFrameSunTransition = false;
    let soundPlayedAtFrameBreath = false;
    let soundPlayedAtFrameGrass = false;
    let soundPlayedAtFrameOutro = false;

    function preloadFrames() {
      return new Promise((resolve) => {
        for (let i = 1; i <= FRAME_COUNT; i++) {
          const img = new Image();
          const frameNum = String(i).padStart(4, '0');
          img.src = FRAME_PATH + frameNum + FRAME_EXT;
          img.onload = () => {
            imagesLoaded++;
            updateLoaderProgress();
            if (imagesLoaded === FRAME_COUNT) resolve();
          };
          img.onerror = () => {
            imagesLoaded++;
            if (imagesLoaded === FRAME_COUNT) resolve();
          };
          frames[i - 1] = img;
        }
      });
    }

    function updateLoaderProgress() {
      if (initialLoadingComplete) return;
      const totalInitialFrames = FRAME_COUNT + FRAME_COUNT_2;
      const loadedInitialFrames = imagesLoaded + imagesLoaded2;
      const frameProgress = (loadedInitialFrames / totalInitialFrames) * 90;
      const totalProgress = 10 + frameProgress;
      loaderFill.style.width = totalProgress + '%';
      loaderPercentage.textContent = Math.round(totalProgress) + '%';
      const roundedProgress = Math.round(totalProgress * 2) / 2;
      if (Math.abs(roundedProgress - lastBlurProgress) >= 0.1 || lastBlurProgress === -1) {
        const blurAmount = 50 * (1 - totalProgress / 100);
        loader.style.setProperty('--blur-amount', blurAmount + 'px');
        lastBlurProgress = roundedProgress;
      }
    }

    function preloadFrames2() {
      return new Promise((resolve) => {
        for (let i = 1; i <= FRAME_COUNT_2; i++) {
          const img = new Image();
          const frameNum = String(i).padStart(4, '0');
          img.src = FRAME_PATH_2 + frameNum + FRAME_EXT_2;
          img.onload = () => {
            imagesLoaded2++;
            updateLoaderProgress();
            if (imagesLoaded2 === FRAME_COUNT_2) resolve();
          };
          img.onerror = () => {
            imagesLoaded2++;
            updateLoaderProgress();
            if (imagesLoaded2 === FRAME_COUNT_2) resolve();
          };
          frames2[i - 1] = img;
        }
      });
    }

    function preloadFrames3() {
      return new Promise((resolve) => {
        for (let i = 1; i <= FRAME_COUNT_3; i++) {
          const img = new Image();
          const frameNum = String(i).padStart(4, '0');
          img.src = FRAME_PATH_3 + frameNum + FRAME_EXT_3;
          img.onload = () => { imagesLoaded3++; if (imagesLoaded3 === FRAME_COUNT_3) resolve(); };
          img.onerror = () => { imagesLoaded3++; if (imagesLoaded3 === FRAME_COUNT_3) resolve(); };
          frames3[i - 1] = img;
        }
      });
    }

    function preloadFrames4() {
      return new Promise((resolve) => {
        for (let i = 1; i <= FRAME_COUNT_4; i++) {
          const img = new Image();
          const frameNum = String(i).padStart(4, '0');
          img.src = FRAME_PATH_4 + frameNum + FRAME_EXT_4;
          img.onload = () => { imagesLoaded4++; if (imagesLoaded4 === FRAME_COUNT_4) resolve(); };
          img.onerror = () => { imagesLoaded4++; if (imagesLoaded4 === FRAME_COUNT_4) resolve(); };
          frames4[i - 1] = img;
        }
      });
    }

    function preloadFrames5() {
      return new Promise((resolve) => {
        for (let i = 1; i <= FRAME_COUNT_5; i++) {
          const img = new Image();
          const frameNum = String(i).padStart(4, '0');
          img.src = FRAME_PATH_5 + frameNum + FRAME_EXT_5;
          img.onload = () => { imagesLoaded5++; if (imagesLoaded5 === FRAME_COUNT_5) resolve(); };
          img.onerror = () => { imagesLoaded5++; if (imagesLoaded5 === FRAME_COUNT_5) resolve(); };
          frames5[i - 1] = img;
        }
      });
    }

    function preloadFrames6() {
      return new Promise((resolve) => {
        for (let i = 1; i <= FRAME_COUNT_6; i++) {
          const img = new Image();
          const frameNum = String(i).padStart(4, '0');
          img.src = FRAME_PATH_6 + frameNum + FRAME_EXT_6;
          img.onload = () => { imagesLoaded6++; if (imagesLoaded6 === FRAME_COUNT_6) resolve(); };
          img.onerror = () => { imagesLoaded6++; if (imagesLoaded6 === FRAME_COUNT_6) resolve(); };
          frames6[i - 1] = img;
        }
      });
    }

    function preloadInitialVideos() {
      return new Promise((resolve) => {
        let videosLoaded = 0;
        const totalVideos = 3;
        function checkComplete() {
          videosLoaded++;
          if (videosLoaded === totalVideos) {
            loaderFill.style.width = '10%';
            loaderPercentage.textContent = '10%';
            loader.style.setProperty('--blur-amount', '45px');
            resolve();
          }
        }
        const videos = [
          { video: scene1Video, name: 'Scene-1' },
          { video: scene2Video, name: 'Scene-2' },
          { video: scene3Video, name: 'Scene-3' }
        ];
        videos.forEach(function(item) {
          if (item.video.readyState >= 3) {
            checkComplete();
          } else {
            item.video.addEventListener('canplaythrough', checkComplete, { once: true });
            item.video.addEventListener('error', function() { checkComplete(); }, { once: true });
            item.video.load();
          }
        });
      });
    }

    function preloadRemainingVideos() {
      return new Promise((resolve) => {
        let videosLoaded = 0;
        const totalVideos = 4;
        function checkComplete() {
          videosLoaded++;
          if (videosLoaded === totalVideos) resolve();
        }
        const videos = [scene4Video, scene5Video, scene6Video, scene7Video];
        videos.forEach(function(video) {
          if (video.readyState >= 3) {
            checkComplete();
          } else {
            video.addEventListener('canplaythrough', checkComplete, { once: true });
            video.addEventListener('error', checkComplete, { once: true });
            video.load();
          }
        });
      });
    }

    function setupCanvas() {
      const firstFrame = frames[0];
      if (firstFrame && firstFrame.naturalWidth) {
        canvas.width = firstFrame.naturalWidth;
        canvas.height = firstFrame.naturalHeight;
        drawFrame(0);
      }
    }

    function setupCanvas2() {
      const firstFrame = frames2[0];
      if (firstFrame && firstFrame.naturalWidth) {
        canvas2.width = firstFrame.naturalWidth;
        canvas2.height = firstFrame.naturalHeight;
        drawFrame2(0);
      }
    }

    function setupCanvas3() {
      const firstFrame = frames3[0];
      if (firstFrame && firstFrame.naturalWidth) {
        canvas3.width = firstFrame.naturalWidth;
        canvas3.height = firstFrame.naturalHeight;
        drawFrame3(0);
      }
    }

    function setupCanvas4() {
      const firstFrame = frames4[0];
      if (firstFrame && firstFrame.naturalWidth) {
        canvas4.width = firstFrame.naturalWidth;
        canvas4.height = firstFrame.naturalHeight;
        drawFrame4(0);
      }
    }

    function setupCanvas5() {
      const firstFrame = frames5[0];
      if (firstFrame && firstFrame.naturalWidth) {
        canvas5.width = firstFrame.naturalWidth;
        canvas5.height = firstFrame.naturalHeight;
        drawFrame5(0);
      }
    }

    function setupCanvas6() {
      const firstFrame = frames6[0];
      if (firstFrame && firstFrame.naturalWidth) {
        canvas6.width = firstFrame.naturalWidth;
        canvas6.height = firstFrame.naturalHeight;
        drawFrame6(0);
      }
    }

    function drawFrame(index) {
      const frame = frames[index];
      if (frame && frame.complete) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(frame, 0, 0);
        currentFrame = index;
        
        // Play sound when threshold frame is reached
        if (index >= SOUND_FRAME_THRESHOLD_WHOOSE && !soundPlayedAtWhoose) {
          soundPlayedAtWhoose = true;
          frameSoundWhoose.currentTime = 0;
          frameSoundWhoose.play().catch(err => console.log('Audio play failed:', err));
        }
      }
    }

    function drawFrame2(index) {
      const frame = frames2[index];
      if (frame && frame.complete) {
        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);
        ctx2.drawImage(frame, 0, 0);
        currentFrame2 = index;
        
        // Play sound when threshold frame is reached
        if (index >= SOUND_FRAME_THRESHOLD_SUN_TRANSITION && !soundPlayedAtFrameSunTransition) {
          soundPlayedAtFrameSunTransition = true;
          frameSoundSunTransition.currentTime = 0;
          frameSoundSunTransition.play().catch(err => console.log('Audio play failed:', err));
        }
      }
    }

    function drawFrame3(index) {
      const frame = frames3[index];
      if (frame && frame.complete) {
        ctx3.clearRect(0, 0, canvas3.width, canvas3.height);
        ctx3.drawImage(frame, 0, 0);
        currentFrame3 = index;
        
        // Play sound when threshold frame is reached
        if (index >= SOUND_FRAME_THRESHOLD_BREATH && !soundPlayedAtFrameBreath) {
          soundPlayedAtFrameBreath = true;
          frameSoundBreath.currentTime = 0;
          frameSoundBreath.play().catch(err => console.log('Audio play failed:', err));
        }
      }
    }

    function drawFrame4(index) {
      const frame = frames4[index];
      if (frame && frame.complete) {
        ctx4.clearRect(0, 0, canvas4.width, canvas4.height);
        ctx4.drawImage(frame, 0, 0);
        currentFrame4 = index;
      }
    }

    function drawFrame5(index) {
      const frame = frames5[index];
      if (frame && frame.complete) {
        ctx5.clearRect(0, 0, canvas5.width, canvas5.height);
        ctx5.drawImage(frame, 0, 0);
        currentFrame5 = index;
        
        // Play sound when threshold frame is reached
        if (index >= SOUND_FRAME_THRESHOLD_GRASS && !soundPlayedAtFrameGrass) {
          soundPlayedAtFrameGrass = true;
          frameSoundGrass.currentTime = 0;
          frameSoundGrass.play().catch(err => console.log('Audio play failed:', err));
        }
      }
    }

    function drawFrame6(index) {
      const frame = frames6[index];
      if (frame && frame.complete) {
        ctx6.clearRect(0, 0, canvas6.width, canvas6.height);
        ctx6.drawImage(frame, 0, 0);
        currentFrame6 = index;
        
        // Play sound when threshold frame is reached
        if (index >= SOUND_FRAME_THRESHOLD_OUTRO && !soundPlayedAtFrameOutro) {
          soundPlayedAtFrameOutro = true;
          frameSoundOutro.currentTime = 0;
          frameSoundOutro.play().catch(err => console.log('Audio play failed:', err));
        }
      }
    }

    // Auto-complete animation - only used for canvas 1 and 6
    function animateCanvasToEnd(canvasIndex, frameCount, drawFunction, onComplete) {
      const duration = frameCount * 25;
      const startTime = performance.now();
      let currentFrameIndex = 0;
      
      isAutoAnimating = true;
      document.body.classList.add('no-scroll');
      
      function animateLoop(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const frameIndex = Math.floor(progress * (frameCount - 1));
        
        if (frameIndex !== currentFrameIndex) {
          currentFrameIndex = frameIndex;
          drawFunction(frameIndex);
          updateCanvasProgress(canvasIndex, progress);
        }
        
        if (progress < 1) {
          requestAnimationFrame(animateLoop);
        } else {
          drawFunction(frameCount - 1);
          updateCanvasProgress(canvasIndex, 1);
          
          if (canvasIndex === 1) {
            currentFrame = frameCount - 1;
            targetFrame = frameCount - 1;
          } else if (canvasIndex === 6) {
            currentFrame6 = frameCount - 1;
            targetFrame6 = frameCount - 1;
          }
          
          isAutoAnimating = false;
          setTimeout(onComplete, 100);
        }
      }
      
      requestAnimationFrame(animateLoop);
    }

    // Smooth interpolation animation loops
    function animate() {
      if (!isAutoAnimating) {
        const diff = targetFrame - currentFrame;
        if (Math.abs(diff) > 0.01) {
          const step = diff * 0.25;
          const nextFrame = Math.abs(step) < 1 ? currentFrame + Math.sign(diff) : Math.round(currentFrame + step);
          if (nextFrame !== currentFrame && nextFrame >= 0 && nextFrame < FRAME_COUNT) {
            drawFrame(nextFrame);
          }
        }
      }
      requestAnimationFrame(animate);
    }

    function animate2() {
      const diff = targetFrame2 - currentFrame2;
      if (Math.abs(diff) > 0.01) {
        const step = diff * 0.25;
        const nextFrame = Math.abs(step) < 1 ? currentFrame2 + Math.sign(diff) : Math.round(currentFrame2 + step);
        if (nextFrame !== currentFrame2 && nextFrame >= 0 && nextFrame < FRAME_COUNT_2) {
          drawFrame2(nextFrame);
        }
      }
      requestAnimationFrame(animate2);
    }

    function animate3() {
      const diff = targetFrame3 - currentFrame3;
      if (Math.abs(diff) > 0.01) {
        const step = diff * 0.25;
        const nextFrame = Math.abs(step) < 1 ? currentFrame3 + Math.sign(diff) : Math.round(currentFrame3 + step);
        if (nextFrame !== currentFrame3 && nextFrame >= 0 && nextFrame < FRAME_COUNT_3) {
          drawFrame3(nextFrame);
        }
      }
      requestAnimationFrame(animate3);
    }

    function animate4() {
      const diff = targetFrame4 - currentFrame4;
      if (Math.abs(diff) > 0.01) {
        const step = diff * 0.25;
        const nextFrame = Math.abs(step) < 1 ? currentFrame4 + Math.sign(diff) : Math.round(currentFrame4 + step);
        if (nextFrame !== currentFrame4 && nextFrame >= 0 && nextFrame < FRAME_COUNT_4) {
          drawFrame4(nextFrame);
        }
      }
      requestAnimationFrame(animate4);
    }

    function animate5() {
      const diff = targetFrame5 - currentFrame5;
      if (Math.abs(diff) > 0.01) {
        const step = diff * 0.25;
        const nextFrame = Math.abs(step) < 1 ? currentFrame5 + Math.sign(diff) : Math.round(currentFrame5 + step);
        if (nextFrame !== currentFrame5 && nextFrame >= 0 && nextFrame < FRAME_COUNT_5) {
          drawFrame5(nextFrame);
        }
      }
      requestAnimationFrame(animate5);
    }

    function animate6() {
      if (!isAutoAnimating) {
        const diff = targetFrame6 - currentFrame6;
        if (Math.abs(diff) > 0.01) {
          const step = diff * 0.25;
          const nextFrame = Math.abs(step) < 1 ? currentFrame6 + Math.sign(diff) : Math.round(currentFrame6 + step);
          if (nextFrame !== currentFrame6 && nextFrame >= 0 && nextFrame < FRAME_COUNT_6) {
            drawFrame6(nextFrame);
          }
        }
      }
      requestAnimationFrame(animate6);
    }

    function initLenis() {
      lenis = new Lenis({
        duration: 1.2,
        easing: function(t) { return Math.min(1, 1.001 - Math.pow(2, -10 * t)); },
        orientation: 'vertical',
        gestureOrientation: 'vertical',
        smoothWheel: true,
        wheelMultiplier: 1,
        touchMultiplier: 2,
        infinite: false,
      });

      function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
      }

      lenis.on('scroll', function(e) {
        var scroll = e.scroll;
        
        if (isAutoAnimating) return;
        
        if (scroll < maxScrollReached && !isCorrectingScroll) {
          isCorrectingScroll = true;
          lenis.scrollTo(maxScrollReached, { immediate: true });
          setTimeout(function() { isCorrectingScroll = false; }, 0);
          return;
        }
        maxScrollReached = scroll;

        // CANVAS-1: Auto-complete on first scroll
        if (canvas1Section.offsetParent !== null) {
          var sectionTop = canvas1Section.offsetTop;
          var sectionHeight = canvas1Section.offsetHeight - window.innerHeight;
          var scrollInSection = scroll - sectionTop;
          var sectionProgress = Math.max(0, Math.min(1, scrollInSection / sectionHeight));
          
          if (!canvas1FirstScrollTriggered && sectionProgress > 0.01) {
            canvas1FirstScrollTriggered = true;
            animateCanvasToEnd(1, FRAME_COUNT, drawFrame, function() { playScene2(); });
            return;
          }
          
          targetFrame = Math.floor(sectionProgress * (FRAME_COUNT - 1));
          if (targetFrame !== currentFrame && targetFrame >= 0 && targetFrame < FRAME_COUNT) {
            drawFrame(targetFrame);
          }
          updateCanvasProgress(1, sectionProgress);
          
          if (sectionProgress >= 0.98 && !scene2Played) {
            playScene2();
          }
        }

        // CANVAS-2: Normal scroll behavior - trigger at 95% progress
        if (canvas2Section.offsetParent !== null) {
          var sectionTop2 = canvas2Section.offsetTop;
          var sectionHeight2 = canvas2Section.offsetHeight - window.innerHeight;
          var scrollInSection2 = scroll - sectionTop2;
          var sectionProgress2 = Math.max(0, Math.min(1, scrollInSection2 / sectionHeight2));
          
          targetFrame2 = Math.floor(sectionProgress2 * (FRAME_COUNT_2 - 1));
          if (targetFrame2 !== currentFrame2 && targetFrame2 >= 0 && targetFrame2 < FRAME_COUNT_2) {
            drawFrame2(targetFrame2);
          }
          updateCanvasProgress(2, sectionProgress2);
          
          // trigger next scene at 98% Progress
          if (sectionProgress2 >= 0.98 && !scene4Played) {
            playScene4();
          }
        }

        // CANVAS-3: Normal scroll behavior - trigger at 95% progress
        if (canvas3Section.offsetParent !== null) {
          var sectionTop3 = canvas3Section.offsetTop;
          var sectionHeight3 = canvas3Section.offsetHeight - window.innerHeight;
          var scrollInSection3 = scroll - sectionTop3;
          var sectionProgress3 = Math.max(0, Math.min(1, scrollInSection3 / sectionHeight3));
          
          targetFrame3 = Math.floor(sectionProgress3 * (FRAME_COUNT_3 - 1));
          if (targetFrame3 !== currentFrame3 && targetFrame3 >= 0 && targetFrame3 < FRAME_COUNT_3) {
            drawFrame3(targetFrame3);
          }
          updateCanvasProgress(3, sectionProgress3);
          
          // trigger next scene at 98% Progress
          if (sectionProgress3 >= 0.98 && !scene5Played) {
            playScene5();
          }
        }

        // CANVAS-4: Normal scroll behavior - trigger at 95% progress
        if (canvas4Section.offsetParent !== null) {
          var sectionTop4 = canvas4Section.offsetTop;
          var sectionHeight4 = canvas4Section.offsetHeight - window.innerHeight;
          var scrollInSection4 = scroll - sectionTop4;
          var sectionProgress4 = Math.max(0, Math.min(1, scrollInSection4 / sectionHeight4));
          
          targetFrame4 = Math.floor(sectionProgress4 * (FRAME_COUNT_4 - 1));
          if (targetFrame4 !== currentFrame4 && targetFrame4 >= 0 && targetFrame4 < FRAME_COUNT_4) {
            drawFrame4(targetFrame4);
          }
          updateCanvasProgress(4, sectionProgress4);
          
          // trigger next scene at 98% Progress
          if (sectionProgress4 >= 0.98 && !scene6Played) {
            playScene6();
          }
        }

        // CANVAS-5: Normal scroll behavior - trigger at 95% progress
        if (canvas5Section.offsetParent !== null) {
          var sectionTop5 = canvas5Section.offsetTop;
          var sectionHeight5 = canvas5Section.offsetHeight - window.innerHeight;
          var scrollInSection5 = scroll - sectionTop5;
          var sectionProgress5 = Math.max(0, Math.min(1, scrollInSection5 / sectionHeight5));
          
          targetFrame5 = Math.floor(sectionProgress5 * (FRAME_COUNT_5 - 1));
          if (targetFrame5 !== currentFrame5 && targetFrame5 >= 0 && targetFrame5 < FRAME_COUNT_5) {
            drawFrame5(targetFrame5);
          }
          updateCanvasProgress(5, sectionProgress5);
          
          // trigger next scene at 98% Progress
          if (sectionProgress5 >= 0.98 && !scene7Played) {
            playScene7();
          }
        }

        // CANVAS-6: Auto-complete on first scroll
        if (canvas6Section.offsetParent !== null) {
          var sectionTop6 = canvas6Section.offsetTop;
          var sectionHeight6 = canvas6Section.offsetHeight - window.innerHeight;
          var scrollInSection6 = scroll - sectionTop6;
          var sectionProgress6 = Math.max(0, Math.min(1, scrollInSection6 / sectionHeight6));
          
          if (!canvas6FirstScrollTriggered && sectionProgress6 > 0.01) {
            canvas6FirstScrollTriggered = true;
            animateCanvasToEnd(6, FRAME_COUNT_6, drawFrame6, function() {
              if (canvas6ScrollHint) canvas6ScrollHint.style.display = 'none';
              if (rewindButton) rewindButton.style.display = 'block';
              if (homeLink) homeLink.style.display = 'block';
            });
            return;
          }
          
          targetFrame6 = Math.floor(sectionProgress6 * (FRAME_COUNT_6 - 1));
          if (targetFrame6 !== currentFrame6 && targetFrame6 >= 0 && targetFrame6 < FRAME_COUNT_6) {
            drawFrame6(targetFrame6);
          }
          updateCanvasProgress(6, sectionProgress6);
          
          if (sectionProgress6 >= 0.9) {
            if (canvas6ScrollHint) canvas6ScrollHint.style.display = 'none';
            if (rewindButton) rewindButton.style.display = 'block';
            if (homeLink) homeLink.style.display = 'block';
          } else {
            if (canvas6ScrollHint) canvas6ScrollHint.style.display = 'block';
            if (rewindButton) rewindButton.style.display = 'none';
            if (homeLink) homeLink.style.display = 'none';
          }
        }
        
        lastScrollPosition = scroll;
      });

      requestAnimationFrame(raf);
    }

    function handleScene1Tap() {
      if (scene1Played) return;
      scene1Played = true;
      
      tapOverlay.classList.add('hidden');
      scene1Section.classList.remove('paused');
      
      var menuWrap = document.querySelector('.menu-wrap');
      if (menuWrap) menuWrap.style.display = 'flex';
      
      scene1Video.play();
      
      var videosToWarm = [scene2Video, scene3Video, scene4Video, scene5Video, scene6Video, scene7Video];
      videosToWarm.forEach(function(video, index) {
        warmingUpVideos.add(video);
        video.muted = true;
        video.play().then(function() {
          video.pause();
          video.currentTime = 0;
          video.muted = false;
          warmingUpVideos.delete(video);
        }).catch(function() {
          warmingUpVideos.delete(video);
        });
      });
      
      scene1Video.addEventListener('ended', function() {
        document.body.classList.remove('no-scroll');
        initLenis();
        scene1Section.style.display = 'none';
        drawFrame(0);
        window.scrollTo(0, canvas1Section.offsetTop);
        maxScrollReached = canvas1Section.offsetTop;
      }, { once: true });
    }

    function playScene2() {
      if (scene2Played) return;
      scene2Played = true;
      document.body.classList.add('no-scroll');
      canvas1Section.style.display = 'none';
      scene2Section.style.display = 'flex';
      scene2Section.classList.remove('paused');
      window.scrollTo(0, scene2Section.offsetTop);
      updateActiveMenuButton(2);
      scene2Video.play();
      scene2Video.addEventListener('ended', function() { playScene3(); }, { once: true });
    }

    function playScene3() {
      scene2Section.style.display = 'none';
      scene3Section.style.display = 'flex';
      scene3Section.classList.remove('paused');
      window.scrollTo(0, scene3Section.offsetTop);
      updateActiveMenuButton(3);
      scene3Video.play();
      scene3Video.addEventListener('ended', function() {
        document.body.classList.remove('no-scroll');
        scene3Section.style.display = 'none';
        drawFrame2(0);
        canvas2Section.style.display = 'block';
        window.scrollTo(0, canvas2Section.offsetTop);
        maxScrollReached = canvas2Section.offsetTop;
        updateActiveMenuButton(3);
      }, { once: true });
    }

    function playScene4() {
      if (scene4Played) return;
      scene4Played = true;
      document.body.classList.add('no-scroll');
      canvas2Section.style.display = 'none';
      scene4Section.style.display = 'flex';
      scene4Section.classList.remove('paused');
      window.scrollTo(0, scene4Section.offsetTop);
      updateActiveMenuButton(4);
      scene4Video.play();
      scene4Video.addEventListener('ended', function() {
        document.body.classList.remove('no-scroll');
        scene4Section.style.display = 'none';
        drawFrame3(0);
        canvas3Section.style.display = 'block';
        window.scrollTo(0, canvas3Section.offsetTop);
        maxScrollReached = canvas3Section.offsetTop;
        updateActiveMenuButton(4);
      }, { once: true });
    }

    function playScene5() {
      if (scene5Played) return;
      scene5Played = true;
      document.body.classList.add('no-scroll');
      canvas3Section.style.display = 'none';
      scene5Section.style.display = 'flex';
      scene5Section.classList.remove('paused');
      window.scrollTo(0, scene5Section.offsetTop);
      updateActiveMenuButton(5);
      scene5Video.play();
      scene5Video.addEventListener('ended', function() {
        document.body.classList.remove('no-scroll');
        scene5Section.style.display = 'none';
        drawFrame4(0);
        canvas4Section.style.display = 'block';
        window.scrollTo(0, canvas4Section.offsetTop);
        maxScrollReached = canvas4Section.offsetTop;
        updateActiveMenuButton(5);
      }, { once: true });
    }

    function playScene6() {
      if (scene6Played) return;
      scene6Played = true;
      document.body.classList.add('no-scroll');
      canvas4Section.style.display = 'none';
      scene6Section.style.display = 'flex';
      scene6Section.classList.remove('paused');
      window.scrollTo(0, scene6Section.offsetTop);
      updateActiveMenuButton(6);
      scene6Video.play();
      scene6Video.addEventListener('ended', function() {
        document.body.classList.remove('no-scroll');
        scene6Section.style.display = 'none';
        drawFrame5(0);
        canvas5Section.style.display = 'block';
        window.scrollTo(0, canvas5Section.offsetTop);
        maxScrollReached = canvas5Section.offsetTop;
        updateActiveMenuButton(6);
      }, { once: true });
    }

    function playScene7() {
      if (scene7Played) return;
      scene7Played = true;
      document.body.classList.add('no-scroll');
      canvas5Section.style.display = 'none';
      scene7Section.style.display = 'flex';
      scene7Section.classList.remove('paused');
      window.scrollTo(0, scene7Section.offsetTop);
      updateActiveMenuButton(6);
      scene7Video.play();
      scene7Video.addEventListener('ended', function() {
        document.body.classList.remove('no-scroll');
        scene7Section.style.display = 'none';
        drawFrame6(0);
        canvas6Section.style.display = 'block';
        resetCanvas6UI();
        window.scrollTo(0, canvas6Section.offsetTop);
        maxScrollReached = canvas6Section.offsetTop;
        updateActiveMenuButton(6);
      }, { once: true });
    }

    function setupScene1() {
      scene1Section.addEventListener('click', handleScene1Tap);
    }

    function setupVideoPausePlay() {
      var videoScenes = [scene1Video, scene2Video, scene3Video, scene4Video, scene5Video, scene6Video, scene7Video];
      videoScenes.forEach(function(video) {
        video.addEventListener('play', function() {
          if (warmingUpVideos.has(video)) return;
          video.parentElement.classList.remove('paused');
        });
        video.addEventListener('pause', function() {
          if (warmingUpVideos.has(video)) return;
          video.parentElement.classList.add('paused');
        });
        video.addEventListener('click', function() {
          if (video.paused) video.play();
          else video.pause();
          video.blur();
        });
      });
    }

    function updateCanvasProgress(canvasIndex, progress) {
      var progressCircles = [progressCircle1, progressCircle2, progressCircle3, progressCircle4, progressCircle5, progressCircle6];
      var circle = progressCircles[canvasIndex - 1];
      if (!circle) return;
      var fillElement = circle.querySelector('.progress-fill');
      if (fillElement) {
        var circumference = 2 * Math.PI * 16;
        var offset = circumference - (progress * circumference);
        fillElement.style.strokeDashoffset = offset;
      }
    }

    function resetCanvas6UI() {
      if (canvas6ScrollHint) canvas6ScrollHint.style.display = 'block';
      if (rewindButton) rewindButton.style.display = 'none';
      if (homeLink) homeLink.style.display = 'none';
    }

    var menuWrap = document.querySelector('.menu-wrap');
    var menuButton = document.querySelector('.menu-button');
    
    if (menuButton) {
      menuButton.addEventListener('click', function() {
        menuWrap.classList.toggle('open');
      });
    }

    document.addEventListener('click', function(e) {
      if (menuWrap && !menuWrap.contains(e.target)) {
        menuWrap.classList.remove('open');
      }
    });

    function updateActiveMenuButton(sceneNum) {
      var sceneButtons = document.querySelectorAll('.menu-nav button[data-scene]');
      sceneButtons.forEach(function(btn) {
        btn.classList.remove('active');
        if (parseInt(btn.getAttribute('data-scene')) === sceneNum) {
          btn.classList.add('active');
        }
      });
    }

    function switchToScene(sceneId) {
      var sceneNum = parseInt(sceneId);
      
      menuWrap.classList.remove('open');
      isAutoAnimating = false;
      
      canvas1FirstScrollTriggered = false;
      canvas6FirstScrollTriggered = false;
      
      scene1Section.style.display = 'none';
      scene2Section.style.display = 'none';
      scene3Section.style.display = 'none';
      scene4Section.style.display = 'none';
      scene5Section.style.display = 'none';
      scene6Section.style.display = 'none';
      scene7Section.style.display = 'none';
      canvas1Section.style.display = 'none';
      canvas2Section.style.display = 'none';
      canvas3Section.style.display = 'none';
      canvas4Section.style.display = 'none';
      canvas5Section.style.display = 'none';
      canvas6Section.style.display = 'none';
      
      resetCanvas6UI();
      
      scene1Section.classList.remove('paused');
      scene2Section.classList.remove('paused');
      scene3Section.classList.remove('paused');
      scene4Section.classList.remove('paused');
      scene5Section.classList.remove('paused');
      scene6Section.classList.remove('paused');
      scene7Section.classList.remove('paused');
      
      [scene1Video, scene2Video, scene3Video, scene4Video, scene5Video, scene6Video, scene7Video].forEach(function(video) {
        video.pause();
        video.currentTime = 0;
      });
      
      for (var i = 1; i <= 6; i++) {
        updateCanvasProgress(i, 0);
      }
      
      currentFrame = 0; targetFrame = 0;
      currentFrame2 = 0; targetFrame2 = 0;
      currentFrame3 = 0; targetFrame3 = 0;
      currentFrame4 = 0; targetFrame4 = 0;
      currentFrame5 = 0; targetFrame5 = 0;
      currentFrame6 = 0; targetFrame6 = 0;
      
      scene1Played = false;
      scene2Played = false;
      scene4Played = false;
      scene5Played = false;
      scene6Played = false;
      scene7Played = false;
      
      // Reset sound flags so sounds can play again when navigating from menu
      soundPlayedAtWhoose = false;
      soundPlayedAtFrameSunTransition = false;
      soundPlayedAtFrameBreath = false;
      soundPlayedAtFrameGrass = false;
      soundPlayedAtFrameOutro = false;
      
      if (!lenis) initLenis();
      
      document.body.classList.add('no-scroll');
      
      switch(sceneNum) {
        case 1:
          scene1Section.style.display = 'flex';
          scene1Section.classList.remove('paused');
          tapOverlay.classList.add('hidden');
          scene1Video.play();
          updateActiveMenuButton(1);
          if (lenis) lenis.scrollTo(0, { immediate: true });
          else window.scrollTo(0, 0);
          maxScrollReached = 0;
          scene1Video.addEventListener('ended', function() {
            document.body.classList.remove('no-scroll');
            scene1Section.style.display = 'none';
            canvas1Section.style.display = 'block';
            drawFrame(0);
            if (lenis) lenis.scrollTo(canvas1Section.offsetTop, { immediate: true });
            else window.scrollTo(0, canvas1Section.offsetTop);
            maxScrollReached = canvas1Section.offsetTop;
            updateActiveMenuButton(1);
          }, { once: true });
          break;
        case 2:
          scene2Section.style.display = 'flex';
          scene2Section.classList.remove('paused');
          if (lenis) lenis.scrollTo(scene2Section.offsetTop, { immediate: true });
          else window.scrollTo(0, scene2Section.offsetTop);
          maxScrollReached = scene2Section.offsetTop;
          scene2Video.play();
          updateActiveMenuButton(2);
          scene2Video.addEventListener('ended', function() {
            scene2Section.style.display = 'none';
            scene3Section.style.display = 'flex';
            scene3Section.classList.remove('paused');
            if (lenis) lenis.scrollTo(scene3Section.offsetTop, { immediate: true });
            else window.scrollTo(0, scene3Section.offsetTop);
            scene3Video.play();
            updateActiveMenuButton(3);
            scene3Video.addEventListener('ended', function() {
              document.body.classList.remove('no-scroll');
              scene3Section.style.display = 'none';
              canvas2Section.style.display = 'block';
              drawFrame2(0);
              if (lenis) lenis.scrollTo(canvas2Section.offsetTop, { immediate: true });
              else window.scrollTo(0, canvas2Section.offsetTop);
              maxScrollReached = canvas2Section.offsetTop;
              updateActiveMenuButton(3);
            }, { once: true });
          }, { once: true });
          break;
        case 3:
          scene3Section.style.display = 'flex';
          scene3Section.classList.remove('paused');
          if (lenis) lenis.scrollTo(scene3Section.offsetTop, { immediate: true });
          else window.scrollTo(0, scene3Section.offsetTop);
          maxScrollReached = scene3Section.offsetTop;
          scene3Video.play();
          updateActiveMenuButton(3);
          scene3Video.addEventListener('ended', function() {
            document.body.classList.remove('no-scroll');
            scene3Section.style.display = 'none';
            canvas2Section.style.display = 'block';
            drawFrame2(0);
            if (lenis) lenis.scrollTo(canvas2Section.offsetTop, { immediate: true });
            else window.scrollTo(0, canvas2Section.offsetTop);
            maxScrollReached = canvas2Section.offsetTop;
            updateActiveMenuButton(3);
          }, { once: true });
          break;
        case 5:
          scene5Section.style.display = 'flex';
          scene5Section.classList.remove('paused');
          if (lenis) lenis.scrollTo(scene5Section.offsetTop, { immediate: true });
          else window.scrollTo(0, scene5Section.offsetTop);
          maxScrollReached = scene5Section.offsetTop;
          scene5Video.play();
          updateActiveMenuButton(5);
          scene5Video.addEventListener('ended', function() {
            document.body.classList.remove('no-scroll');
            scene5Section.style.display = 'none';
            canvas4Section.style.display = 'block';
            drawFrame4(0);
            if (lenis) lenis.scrollTo(canvas4Section.offsetTop, { immediate: true });
            else window.scrollTo(0, canvas4Section.offsetTop);
            maxScrollReached = canvas4Section.offsetTop;
            updateActiveMenuButton(5);
          }, { once: true });
          break;
        case 6:
          scene6Section.style.display = 'flex';
          scene6Section.classList.remove('paused');
          if (lenis) lenis.scrollTo(scene6Section.offsetTop, { immediate: true });
          else window.scrollTo(0, scene6Section.offsetTop);
          maxScrollReached = scene6Section.offsetTop;
          scene6Video.play();
          updateActiveMenuButton(6);
          scene6Video.addEventListener('ended', function() {
            document.body.classList.remove('no-scroll');
            scene6Section.style.display = 'none';
            canvas5Section.style.display = 'block';
            drawFrame5(0);
            if (lenis) lenis.scrollTo(canvas5Section.offsetTop, { immediate: true });
            else window.scrollTo(0, canvas5Section.offsetTop);
            maxScrollReached = canvas5Section.offsetTop;
            updateActiveMenuButton(6);
          }, { once: true });
          break;
        case 7:
          scene7Section.style.display = 'flex';
          scene7Section.classList.remove('paused');
          if (lenis) lenis.scrollTo(scene7Section.offsetTop, { immediate: true });
          else window.scrollTo(0, scene7Section.offsetTop);
          maxScrollReached = scene7Section.offsetTop;
          scene7Video.play();
          updateActiveMenuButton(7);
          scene7Video.addEventListener('ended', function() {
            document.body.classList.remove('no-scroll');
            scene7Section.style.display = 'none';
            canvas6Section.style.display = 'block';
            drawFrame6(0);
            resetCanvas6UI();
            if (lenis) lenis.scrollTo(canvas6Section.offsetTop, { immediate: true });
            else window.scrollTo(0, canvas6Section.offsetTop);
            maxScrollReached = canvas6Section.offsetTop;
            updateActiveMenuButton(7);
          }, { once: true });
          break;
      }
      
      updateActiveMenuButton(sceneNum);
    }

    function setupMenuNavigation() {
      var sceneButtons = document.querySelectorAll('.menu-nav button[data-scene]');
      sceneButtons.forEach(function(button) {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          var sceneId = button.getAttribute('data-scene');
          if (sceneId) switchToScene(sceneId);
        });
      });
    }

    function setupRewindButton() {
      if (rewindButton) {
        rewindButton.addEventListener('click', function() {
          switchToScene('1');
        });
      }
    }

    async function loadRemainingResources() {
      await Promise.all([
        preloadRemainingVideos(),
        preloadFrames3(),
        preloadFrames4(),
        preloadFrames5(),
        preloadFrames6()
      ]);
      setupCanvas3();
      setupCanvas4();
      setupCanvas5();
      setupCanvas6();
      console.log('Background loading complete');
    }

    async function init() {
      window.scrollTo(0, 0);
      
      scene1Section.style.display = 'flex';
      scene1Section.style.opacity = '1';
      scene1Video.currentTime = 0;
      tapOverlay.classList.remove('hidden');
      scene1Played = false;
      scene2Played = false;
      maxScrollReached = 0;
      
      // Reset sound flags
      soundPlayedAtWhoose = false;
      soundPlayedAtFrameSunTransition = false;
      soundPlayedAtFrame_3 = false;
      soundPlayedAtFrame_4 = false;
      soundPlayedAtFrame_5 = false;
      soundPlayedAtFrame_6 = false;
      
      canvas1Section.style.display = 'block';
      canvas2Section.style.display = 'none';
      canvas3Section.style.display = 'none';
      canvas4Section.style.display = 'none';
      canvas5Section.style.display = 'none';
      canvas6Section.style.display = 'none';
      scene2Section.style.display = 'none';
      scene3Section.style.display = 'none';
      scene4Section.style.display = 'none';
      scene5Section.style.display = 'none';
      scene6Section.style.display = 'none';
      scene7Section.style.display = 'none';
      
      await preloadInitialVideos();
      await Promise.all([preloadFrames(), preloadFrames2()]);
      
      initialLoadingComplete = true;
      
      setupCanvas();
      setupCanvas2();
      setupScene1();
      setupMenuNavigation();
      setupRewindButton();
      resetCanvas6UI();
      setupVideoPausePlay();
      
      loader.classList.add('hidden');
      
      animate();
      animate2();
      animate3();
      animate4();
      animate5();
      animate6();
      
      loadRemainingResources();
    }

    init();
  </script>
</body>
</html>